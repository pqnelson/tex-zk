\ProvidesPackage{mizar}[2021/12/11 Mizar Syntax Highlighting]

\RequirePackage{listings}
\RequirePackage[dvipsnames]{xcolor}

% https://github.com/jez/latex-solarized
% Solarized colors
\definecolor{sbase03}{HTML}{002B36}
\definecolor{sbase02}{HTML}{073642}
\definecolor{sbase01}{HTML}{586E75}
\definecolor{sbase00}{HTML}{657B83}
\definecolor{sbase0}{HTML}{839496}
\definecolor{sbase1}{HTML}{93A1A1}
\definecolor{sbase2}{HTML}{EEE8D5}
\definecolor{sbase3}{HTML}{FDF6E3}
\definecolor{syellow}{HTML}{B58900}
\definecolor{sorange}{HTML}{CB4B16}
\definecolor{sred}{HTML}{DC322F}
\definecolor{smagenta}{HTML}{D33682}
\definecolor{sviolet}{HTML}{6C71C4}
\definecolor{sblue}{HTML}{268BD2}
\definecolor{scyan}{HTML}{2AA198}
\definecolor{sgreen}{HTML}{859900}

% gh comment 6a737d
\definecolor{gray}{rgb}{0.5,0.5,0.5}
% gh string color 032f62
% ghconstant dark blue 005cc5
%\definecolor{ghBlue}{HTML}{0550ae} % rgb(5, 80, 174)
\definecolor{ghBlue}{HTML}{2075c7}
%\definecolor{ghPurple}{HTML}{8250df} % rbg(130, 80, 223)
% syntax-entity purple 6f42c1
\definecolor{ghPurple}{HTML}{c61b6e}
\definecolor{ghRed}{HTML}{cf222e}  % rbg(207, 34, 46)
\definecolor{ghRed2}{HTML}{953800}  % rgb(149, 56, 0)
% gh variable is orange #e36209
% orange from https://github.com/sellout/emacs-color-theme-solarized
% gh green 22863a
% gh keyword for storage type d73a49
% string regexp dark navy blue 032f62
% invalid [broken, deprecated, unimplemented, etc.] b31d28
% list 735c0f
% gh deleted font color b31d28, background color ffeef0
% inserted font color 22863a, background color f0fff4
% style="background-color:#f0fff4;color:#22863a;"
% changed font color e36209, background color ffebda
%\definecolor{solOrange}{HTML}{cb4b16}%{bd3612}%{fb7640}
%\definecolor{bgcolor}{HTML}{073642} % solarized-dark
% \definecolor{bgcolor}{HTML}{eee8d5} % solarized light
\definecolor{bgcolor}{HTML}{FDF6E3}%{eee8d5} % solarized light
%\definecolor{bgcolor}{HTML}{eee8d5} % solarized light
%\definecolor{base3}{HTML}{fcf4dc} % solarized-dark
\definecolor{base3}{HTML}{002b36} % solarized light
%\definecolor{solarizedGreenHc}{HTML}{
\definecolor{solarizedGreen}{HTML}{859900}
\definecolor{solarizedPurple}{HTML}{ff699e}%{c47896}%{cc6791}%{d33682}
\definecolor{solarizedBlue}{HTML}{268bd2}

\def\defaultCommentStyle{\color{gray}}
\def\mizarDefaultStyle{}
\def\mizarFormulaStyle{\color{smagenta}}%{\color{ghPurple}}%{\color{solarizedPurple}}
\def\mizarKWStyle{\color{sblue}}%{\color{solarizedBlue}}
\def\mizarProofKWStyle{\color{sgreen}}%{\color{scyan}}%{\color{solarizedGreen}}

% hack from https://tex.stackexchange.com/a/536920/14751
\newcommand\beginlstdelim[3]{%
    \def\endlstdelim{#2\egroup}%
    \textcolor{#3}{#1}\bgroup\color{#3}\aftergroup\endlstdelim%
}

\lstdefinelanguage{mizar}%
{
  alsoletter={\&,^,\\,-},
  morekeywords=[0]{->,(\#,\#),.=)},
  moredelim = **[is][{\beginlstdelim{\ by}{;}{sorange}}]{\ by}{;},
  moredelim = **[is][{\beginlstdelim{from}{;}{sorange}}]{from}{;},
  morekeywords=[1]{vocabulary,constructors,%
    according,aggregate,and,antonym,as,associativity,assume,%
    asymmetry,attr,be,begin,canceled,case,cases,cluster,%
    clusters,coherence,commutativity,compatibility,connectedness,%
    consider,consistency,constructors,contradiction,correctness,def,%
    deffunc,define,definition,definitions,defpred,environ,equals,%
    exactly,existence,func,given,hence,hereby,%
    idempotence,if,involutiveness,irreflexivity,is,it,%
    let,means,mode,non,notation,of,or,otherwise,over,per,%
    pred,prefix,projectivity,provided,qua,reconsider,redefine,%
    reflexivity,requirements,reserve,scheme,schemes,section,selector,%
    set,struct,such,symmetry,synonym,take,that,the,then,%
    theorem,theorems,thesis,thus,to,transitivity,uniqueness,%
    vocabulary,where},%
  keywordstyle=[1]{\mizarKWStyle},
  morekeywords=[2]{proof,@proof,end,now,suppose},
  keywordstyle=[2]{\mizarProofKWStyle},
  morekeywords=[3]{\&,being,iff,implies,ex,st,for,holds,not},
  keywordstyle=[3]{\mizarFormulaStyle},
  morekeywords=[4]{$1,$1,$2,$3,$4,$5,$6,$7,$8},
  morekeywords=[5]{;},
  keywordstyle=[5]{},
  commentstyle=\defaultCommentStyle,
  sensitive=t,%
  morecomment=[l]::%
}

\lstnewenvironment{litmizar}%
                  {
                    \lstset{language=mizar,
                      basicstyle=\color{sbase03}\ttfamily\small,
                      backgroundcolor=\color{bgcolor},
                      upquote=true,
                      literate={c=}{$\subseteq$}2}}%
                  {}

\RequirePackage{mdframed}
\mdfsetup{skipabove=\medskipamount,
  skipbelow=\medskipamount,
  outermargin=-1em,
  innermargin=-1em,
  leftmargin=0pt,
  rightmargin=0pt,
  innerleftmargin=1em,
  innerrightmargin=0pt,
  rightline=false,
  leftline=false,
  frametitlerule=true,
  innertopmargin=\topsep,
  innerbottommargin=\topsep,
  splittopskip=\topsep}
\lstnewenvironment{mizar}%
                  {\smallbreak\advance\leftskip\parindent\mdframed[backgroundcolor=bgcolor]
                   %\mdframed[backgroundcolor=bgcolor,outerlinewidth=1pt]
                    \lstset{language=mizar,
                      basicstyle=\color{sbase03}\ttfamily\small,
%                      basicstyle=\ttfamily\small,
                      upquote=true}}%
                  {\endmdframed\smallbreak}
\lstset{%
  basicstyle=\ttfamily,
  language=mizar,
%  backgroundcolor=\color{bgcolor}
}
%% \newenvironment{mizar}%
%%                {\begin{mdframed}[backgroundcolor=bgcolor]\begin{rawmizar}}
%%                {\end{rawmizar}{\end{mdframed}}}
%%\def\mizar{\begin{rawmizar}}
%%\def\endmizar{\end{rawmizar}}
